{% include "store/base.html" %}

{% load static %}


{% load crispy_forms_tags %}



{% block content %}

<style>
    body {


        background-color: lightgray;

    }
</style>

<body>
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <li {% if message.tags %} class=" {{ message.tags }} " {% endif %}> {{ message }} </li>
        {% endfor %}
    </ul>
    {% endif %}
    <br>

    <div class="container bg-white shadow-md p-5 form-layout">


        <h3> <i class="fa fa-chevron-circle-right" aria-hidden="true"></i> &nbsp; Product Update </h3>

        <p> Update the product details </p>

        <hr>

        <br>

        <form action="" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form|crispy }}
            <!-- Render the main form -->
            <br>

            {{ formset.management_form }}
            {% for image_form in formset %}

            {% if image_form.instance.pk %}
            <div class="card-body">
                <input type="hidden" name="{{ formset.prefix }}-{{ forloop.counter0 }}-id"
                    value="{{ image_form.instance.id }}">
                <!-- Existing image information -->
                <img class="d-block w-100" src="{{ image_form.instance.image.url }}" alt="Current Image" width="100%"
                    height="190">
                <br>
                <div class="input-group-prepend">

                    <div class="input-group-text">
                        Delete Image
                        <div class="position-relative top-50" style="padding-left: 1rem;">{{ image_form.DELETE }}</div>
                    </div>
                </div>
                <br>
            </div>

            <div class="input-group mb-3">
                <!-- Manually create the file input -->
                <input type="file" class="form-control" id="id_image_{{ forloop.counter }}"
                    name="{{ image_form.image.html_name }}"
                    onchange="updateFilename('filename-preview-{{ image_form.image.id_for_label }}')">
                <span class="input-group-text" id="filename-preview-{{ image_form.image.id_for_label }}"></span>
            </div>
            <hr>
            {% else %}
            {% if forloop.counter <= 2 %}
            <div class="input-group mb-3">
                <!-- Manually create the file input -->
                <input type="file" class="form-control" id="{{ image_form.image.id_for_label }}" name="{{ image_form.image.html_name }}" style="display: none;" onchange="updateFilename(this)">
                <!-- Custom button to trigger file input -->
                <div class="input-group-prepend">
                    <button class="btn btn-primary custom-file-upload" type="button" onclick="document.getElementById('{{ image_form.image.id_for_label }}').click()">Add new image</button>
                </div>
                <!-- Container to display the filename -->
                <span class="input-group-text" id="filename-preview-{{ image_form.image.id_for_label }}"></span>
            </div>
            {% endif %}

    {% endif %}

    {%endfor%}

    <br>
    <div class="d-flex justify-content-center"><button type="submit"
        class="btn btn-primary navbar-btn text-white w-100 p-2 text-center">Update Product</button></div>
        <br>
        <div class="d-flex justify-content-center">
            <a href="{% url 'product-delete' product.pk %}" class="btn btn-danger navbar-btn text-white w-100 p-2 text-centerr" onclick="return confirm('Are you sure you want to delete this product?');">Delete Product</a>
            </div>

</div>

</div>

   

    </form>
   



</body>


<br> <br>

<script>
    function updateFilename(input) {
        var filenamePreviewId = "filename-preview-" + input.id;
        var filenamePreview = document.getElementById(filenamePreviewId);

        if (input.files && input.files[0]) {
            var filename = input.files[0].name;
            var truncatedFilename = filename.substring(0, 10); // Get first 10 characters
            filenamePreview.textContent = truncatedFilename;
        } else {
            filenamePreview.textContent = "";
        }
    }
</script>


{% endblock %}